
# 标的物授权实现
    获取具体标的物的授权内容时,不在通过授权服务获取.改为直接通过标的物服务来实现授权.但是所有标的物服务统一实现授权接口.实现约定好的URL路由.

## 授权关键信息确认过程:
    1: 标的物服务实现统一的API,根据颜色态返回对应的颜色态的授权含义(其中包含以下结果:正式授权,测试授权,文本信息(标签,例如用户组VIP1))
    2: 策略信息编译完成后,动态调用对应标的物的API获取颜色集对应的授权数据.然后把结果直接写入到编译之后的对象中.状态机改变时,即可以直接读取到对应的授权信息.  

## 合约服务对于授权的实现过程:
    合约服务在合约每次接受到新事件之后,都会根据当前进入的状态机状态来获取对应的颜色集以及对应的授权属性(或者动态读取颜色集对应的授权属性,由上面的实现方式决定).
    以此来计算授权结果,保存在合约信息中.后续的所有授权结果只需要通过合约ID查询合约的授权状态即可.

## 通用授权API

    1.标的物服务对应的颜色态授权含义(其中包含以下结果:正式授权,测试授权,文本信息(标签,例如用户组VIP1))

    2.获取标的物授权: subjectAuth   /v2/auths/:subjectType/:subjectId/(result|content)  返回形式:result:授权结果 content:标的物内容
      此接口由甲方标的物服务自己组织或者查询所有需要的合约ID. 例如展品服务,前端API直接获取展品,但是用户使用的合约则由展品服务查询.

    3.根据合约ID获取标的物授权: subjectContractAuth   /v2/auths/:subjectType/:subjectId/contractAuth/(result|content)?contractIds={contractIds}  返回形式:同上
      此接口由标的物服务根据参数中的合约ID来做授权. 例如资源服务需要实现.实际使用中,展品服务对于合约有定制化的范围锁定需求.数据存放在展品服务中.所以需要展品服务提供对应的合同ID来做授权确认.

    4.获取标的物的子依赖内容: subjectDependencyAuth /v2/auths/:subjectType/:subjectId/subDependency/(result|content)

    5.根据合约ID获取标的物的子依赖内容: subjectDependencyContractAuth /v2/auths/:subjectType/:subjectId/subDependency/(result|content)
      
 
## 关于签约限制方面的实现大概流程如下:

    1.假定需要特定标的物的标签符合给定值(例如标的物是飞致会员用户组,标签为黄金会员),系统会通过标的物ID查询所有乙方与该标的物签约的合约.
      然后获取合约当下状态的所有颜色态,判定色块是标签,且符合约定的标签内容(黄金会员),则代表可以签约.
    2.如果需要指定策略的标签符合给定值,则直接查询乙方与该策略签的合约.验证逻辑同上.
    3.如果签约条件是其他freelog限定的,则直接动态验证即可,例如public或者registered_user
  

 

